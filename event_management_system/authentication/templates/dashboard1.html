<!-- events/templates/events/user_dashboard.html -->
{% extends 'base.html' %}

{% block title %}User Dashboard - My Project{% endblock %}

{% block content %}
    <h1>User Dashboard</h1>

    <h2>Your Registrations:</h2>
    <ul>
        {% for registration in user_registrations %}
            <li>
                <strong>Event:</strong> {{ registration.event.title }}<br>
                <strong>Date:</strong> {{ registration.event.date }}<br>
                <strong>Time:</strong> {{ registration.event.time }}<br>
                <strong>Location:</strong> {{ registration.event.location_name }}<br>
                <button onclick="cancelRegistration({{ registration.id }})">Cancel Registration</button>
                <hr>
            </li>
        {% endfor %}
    </ul>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function cancelRegistration(registrationId) {
            const csrftoken = document.cookie.match(/csrftoken=([^ ;]+)/)[1];

            axios.delete(`http://127.0.0.1:8000/api/registrations/${registrationId}/`, {
                headers: {
                    'X-CSRFToken': csrftoken
                }
            })
            .then(function (response) {
                if (response.status === 204) {
                    alert('Registration canceled successfully!');
                    location.reload();  // Refresh the page after canceling registration
                } else {
                    alert('Cancellation failed.');
                }
            })
            .catch(function (error) {
                console.error('Error during cancellation:', error);
                alert('Cancellation failed. Please try again.');
            });
        }
    </script>
{% endblock %}
